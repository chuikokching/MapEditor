<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fill-in-the-blank text</title>
    <link rel="stylesheet" href="src/plugins/easy-button.css">
    <link rel="stylesheet" href="src/css/bootstrap.css">
    <link rel="stylesheet" href="src/leaflet.css">
    <link rel="stylesheet" href="src/plugins/L.Control.Sidebar.css">
    <script src="src/leaflet-src.js"></script>
    <script src="src/jquery-3.2.0.min.js"></script>
    <script src="https://leaflet.github.io/Path.Drag.js/src/Path.Drag.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script type="text/javascript" src="src/js/XMLGenerator.js"></script>
    <script src="src/plugins/L.Control.MousePosition.js"></script>
    <script src="src/plugins/L.Control.Sidebar.js"></script>
    <script src="src/plugins/easy-button.js"></script>
    <script src="src/plugins/FileSaver.js-master/src/FileSaver.js"></script>

    <style>
        #mapdiv{
            height:100vh;
            text-align: center;
        }
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            text-align: center;
        }
    </style>
</head>
<body>
<div>
    <div id="mapdiv" class="col-md-12"></div>
    <div id="side-bar" class="col-md-10">
        <h4>Zoom Level: <span id='zoom-level'></span></h4>
        <h4>Map Center: <span id='map-center'></span></h4>
        <h4>Mouse Location: <span id='mouse-location'></span></h4>
        <br>
        <div>
            <button id="export_exerciseChain" class="btn btn-primary btn-block">ExerciseChain Export</button>
        </div>
        <br>
        <div>
            <button id="export_Stage" class="btn btn-primary btn-block">Stage Export</button>
        </div>
    </div>

</div>
<script type="text/javascript">
    var ctlMouseposition;
    var ctlSidebar;
    var ctlEasybutton;
    var output=[];
    var temp;
    var Land_overlay_imagepath=[
        "img-EUFlag/Germany.png",
        "img-EUFlag/France.png",
        "img-EUFlag/Spain.png",
        "img-EUFlag/Croatia.png",
        "img-EUFlag/Belgium.png",
        "img-EUFlag/Bulgaria.png",
        "img-EUFlag/Cyprus.png",
        "img-EUFlag/Estonia.png",
        "img-EUFlag/Finland.png",
        "img-EUFlag/Greece.png",
        "img-EUFlag/Latvia.png",
        "img-EUFlag/Lithuania.png",
        "img-EUFlag/Malta.png",
        "img-EUFlag/Portugal.png",
        "img-EUFlag/Italy.png",
        "img-EUFlag/Romania.png",
        "img-EUFlag/Denmark.png",
        "img-EUFlag/Ireland.png",
        "img-EUFlag/The United Kingdom.png",
        "img-EUFlag/The Netherlands.png",
        "img-EUFlag/Luxemburg.png",
        "img-EUFlag/Austria.png",
        "img-EUFlag/The Czech Republic.png",
        "img-EUFlag/Hungary.png",
        "img-EUFlag/Slovakia.png",
        "img-EUFlag/Poland.png",
        "img-EUFlag/Slovenia.png",
        "img-EUFlag/Sweden.png",
    ];
    var Land_overlay_array_coordinate=[
        [[50.9779,-19.4233],[48.6701,-13.3545]],
        [[47.9779,-19.4233],[45.6701,-13.3545]],
        [[44.9779,-19.4233],[42.6701,-13.3545]],
        [[41.9779,-19.4233],[39.6701,-13.3545]],
        [[38.9779,-19.4233],[36.6701,-13.3545]],
        [[50.9779,-26.4233],[48.6701,-20.3545]],
        [[47.9779,-26.4233],[45.6701,-20.3545]],
        [[44.9779,-26.4233],[42.6701,-20.3545]],
        [[41.9779,-26.4233],[39.6701,-20.3545]],
        [[38.9779,-26.4233],[36.6701,-20.3545]]
    ];

    var Deutschland,Deu,Deutschlandpoly_array,Deutschland_imageBound,Deutschland_overlay,Deutschland_polygon;
    var Frankreich,Fra,Frankreichpoly_array,Frankreich_imageBound,Frankreich_overlay,Frankreich_polygon;
    var Spanien,Spa,Spanienpoly_array,Spanien_imageBound,Spanien_overlay,Spanien_polygon;
    var Croatia,Cro,Croatiapoly_array, Croatia_imageBound, Croatia_overlay, Croatia_polygon;
    var Belgium,Bel,Belgiumpoly_array,Belgium_imageBound,Belgium_overlayer,Belgium_polygon;
    var Bulgaria,Bul,Bulgariapoly_array,Bulgaria_imageBound,Bulgaria_overlayer,Bulgaria_polygon;
    var Cyprus,Cyp,Cypruspoly_array,Cyprus_imageBound,Cyprus_overlayer,Cyprus_polygon;
    var Estonia,Est,Estoniapoly_array,Estonia_imageBound,Estonia_overlayer,Estonia_polygon;
    var Finland,Fin,Finlandpoly_array,Finland_imageBound,Finland_overlayer,Finland_polygon;
    var Greece,Gre,Greecepoly_array,Greece_imageBound,Greece_overlayer,Greece_polygon;
    var Latvia,Lat,Latviapoly_array,Latvia_imageBound,Latvia_overlayer,Latvia_polygon;
    var Lithuania,Lit,Lithuaniapoly_array,Lithuania_imageBound,Lithuania_overlayer,Lithuania_polygon;
    var Malta,Mal,Maltapoly_array,Malta_imageBound,Malta_overlayer,Malta_polygon;
    var Portugal,Por,Portugalpoly_array,Portugal_imageBound,Portugal_overlayer,Portugal_polygon;
    var Italy,Ita,Italypoly_array,Italy_imageBound,Italy_overlayer,Italy_polygon;
    var Romania,Rom,Romaniapoly_array,Romania_imageBound,Romania_overlayer,Romania_polygon;
    var Denmark,Den,Denmarkpoly_array,Denmark_imageBound,Denmark_overlayer,Denmark_polygon;
    var Ireland,Ire,Irelandpoly_array, Ireland_imageBound, Ireland_overlay, Ireland_polygon;
    var UK,UK1,UKpoly_array, UK_imageBound, UK_overlay, UK_polygon;
    var Netherland,Net,Netherlandpoly_array, Netherland_imageBound, Netherland_overlay, Netherland_polygon;
    var Luxenburg,Lux,Luxenburgpoly_array, Luxenburg_imageBound, Luxenburg_overlay, Luxenburg_polygon;
    var Austria,Aus,Austriapoly_array, Austria_imageBound, Austria_overlay, Austria_polygon;
    var Czechia,Cze,Czechiapoly_array, Czechia_imageBound, Czechia_overlay, Czechia_polygon;
    var Hungary,Hun,Hungarypoly_array, Hungary_imageBound, Hungary_overlay, Hungary_polygon;
    var Slovakia,Slo1,Slovakiapoly_array, Slovakia_imageBound, Slovakia_overlay, Slovakia_polygon;
    var Poland,Pol, Polandpoly_array, Poland_imageBound, Poland_overlay, Poland_polygon;
    var Slovenia,Slo2,Sloveniapoly_array, Slovenia_imageBound, Slovenia_overlay, Slovenia_polygon;
    var Sweden,Swe, Swedenpoly_array, Sweden_imageBound, Sweden_overlay, Sweden_polygon;

    Deutschland = [Deu,Deutschlandpoly_array,Deutschland_imageBound,Deutschland_overlay,Deutschland_polygon];
    Frankreich  = [Fra,Frankreichpoly_array,Frankreich_imageBound,Frankreich_overlay,Frankreich_polygon];
    Spanien = [Spa,Spanienpoly_array,Spanien_imageBound,Spanien_overlay,Spanien_polygon];
    Croatia= [Cro,Croatiapoly_array, Croatia_imageBound, Croatia_overlay, Croatia_polygon];
    Belgium=[Bel,Belgiumpoly_array,Belgium_imageBound,Belgium_overlayer,Belgium_polygon];
    Bulgaria=[Bul,Bulgariapoly_array,Bulgaria_imageBound,Bulgaria_overlayer,Bulgaria_polygon];
    Cyprus=[Cyp,Cypruspoly_array,Cyprus_imageBound,Cyprus_overlayer,Cyprus_polygon];
    Estonia=[Est,Estoniapoly_array,Estonia_imageBound,Estonia_overlayer,Estonia_polygon];
    Finland=[Fin,Finlandpoly_array,Finland_imageBound,Finland_overlayer,Finland_polygon];
    Greece=[Gre,Greecepoly_array,Greece_imageBound,Greece_overlayer,Greece_polygon];
    Latvia=[Lat,Latviapoly_array,Latvia_imageBound,Latvia_overlayer,Latvia_polygon];
    Lithuania=[Lit,Lithuaniapoly_array,Lithuania_imageBound,Lithuania_overlayer,Lithuania_polygon];
    Malta=[Mal,Maltapoly_array,Malta_imageBound,Malta_overlayer,Malta_polygon];
    Portugal=[Por,Portugalpoly_array,Portugal_imageBound,Portugal_overlayer,Portugal_polygon];
    Italy=[Ita,Italypoly_array,Italy_imageBound,Italy_overlayer,Italy_polygon];
    Romania=[Rom,Romaniapoly_array,Romania_imageBound,Romania_overlayer,Romania_polygon];
    Denmark=[Den,Denmarkpoly_array,Denmark_imageBound,Denmark_overlayer,Denmark_polygon];
    Ireland=[Ire,Irelandpoly_array, Ireland_imageBound, Ireland_overlay, Ireland_polygon];
    UK=[UK1,UKpoly_array, UK_imageBound, UK_overlay, UK_polygon];
    Netherland=[Net,Netherlandpoly_array, Netherland_imageBound, Netherland_overlay, Netherland_polygon];
    Luxenburg=[Lux,Luxenburgpoly_array, Luxenburg_imageBound, Luxenburg_overlay, Luxenburg_polygon];
    Austria=[Aus,Austriapoly_array, Austria_imageBound, Austria_overlay, Austria_polygon];
    Czechia=[Cze,Czechiapoly_array, Czechia_imageBound, Czechia_overlay, Czechia_polygon];
    Hungary=[Hun,Hungarypoly_array, Hungary_imageBound, Hungary_overlay, Hungary_polygon];
    Slovakia=[Slo1,Slovakiapoly_array, Slovakia_imageBound, Slovakia_overlay, Slovakia_polygon];
    Poland=[Pol, Polandpoly_array, Poland_imageBound, Poland_overlay, Poland_polygon];
    Slovenia=[Slo2,Sloveniapoly_array, Slovenia_imageBound, Slovenia_overlay, Slovenia_polygon];
    Sweden=[Swe, Swedenpoly_array, Sweden_imageBound, Sweden_overlay, Sweden_polygon];


    var mymap = L.map('mapdiv', {
        center:[48.82791, 17.28320],
        zoom:5,
        scrollWheelZoom:true,
        dragging: true,
        zoomControl: false,
        closePopupOnClick:false,
        attributionControl: false});

    L.tileLayer('https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}{r}.png').addTo(mymap);
    mymap.options.maxZoom=6;
    mymap.options.minZoom=5;

    ctlSidebar = L.control.sidebar('side-bar').addTo(mymap);

    ctlMouseposition = L.control.mousePosition().addTo(mymap);

    ctlEasybutton = L.easyButton('glyphicon-transfer', function(){
        ctlSidebar.toggle();
    }).addTo(mymap);



    Deutschland[0] = L.imageOverlay('img-EUFlag/background.png',[[52.2577,7.5457],[50.5643,12.8191]]);
    Frankreich[0] = L.imageOverlay('img-EUFlag/background.png',[[48.3152,-0.7863],[45.0089,5.3716]]);
    Spanien[0] = L.imageOverlay('img-EUFlag/background.png',[[41.9998,-5.9084],[38.2600,-0.8189]]);
    Croatia[0] = L.imageOverlay('img-EUFlag/background.png',[[45.2873,13.6488],[44.3642,15.6813]]);
    Belgium[0]= L.imageOverlay('img-EUFlag/background.png',[[51.3014,3.4596],[50.0367,6.0038]]);
    Bulgaria[0] = L.imageOverlay('img-EUFlag/background.png',[[43.7376,23.1167],[41.9248,27.5786]]);
    Cyprus[0] = L.imageOverlay('img-EUFlag/background.png',[[35.7397,32.0400],[34.5163,34.5912]]);
    Estonia[0] = L.imageOverlay('img-EUFlag/background.png',[[59.4646,22.7520],[58.06144,27.0812]]);
    Finland[0] = L.imageOverlay('img-EUFlag/background.png',[[63.9419,22.9676],[61.5146,29.7236]]);
    Greece[0] = L.imageOverlay('img-EUFlag/background.png',[[39.7219,20.8172],[37.2088,25.6197]]);
    Latvia[0] = L.imageOverlay('img-EUFlag/background.png',[[57.6583,23.0258],[56.4146,26.3036]]);
    Lithuania[0] = L.imageOverlay('img-EUFlag/background.png',[[56.0338,22.6544],[54.7295,25.66904]]);
    Malta[0] = L.imageOverlay('img-EUFlag/background.png',[[36.3225,13.85071],[35.5831,14.91651]]);
    Portugal[0] = L.imageOverlay('img-EUFlag/background.png',[[40.3449,-9.9469],[38.3883,-7.0671]]);
    Italy[0] = L.imageOverlay('img-EUFlag/background.png',[[44.5576,9.8925],[41.9827,13.7533]]);
    Romania[0] = L.imageOverlay('img-EUFlag/background.png',[[47.1194,22.4249],[44.6917,27.1438]]);
    Denmark[0] = L.imageOverlay('img-EUFlag/background.png',[[56.6316,7.8022],[55.4507,10.9407]]);
    Ireland[0] = L.imageOverlay('img-EUFlag/background.png',[[53.9679,-10.0330],[52.0897,-5.9310]]);
    UK[0] = L.imageOverlay('img-EUFlag/background.png',[[53.7260,-3.8692],[50.9529,1.2781]]);
    Netherland[0] = L.imageOverlay('img-EUFlag/background.png',[[53.1733,3.75354],[51.8742,6.6975]]);
    Luxenburg[0] = L.imageOverlay('img-EUFlag/background.png',[[49.9507,5.7681],[49.5245,6.4321]]);
    Austria[0] = L.imageOverlay('img-EUFlag/background.png',[[48.0767,13.0579],[46.8673,15.9291]]);
    Czechia[0] = L.imageOverlay('img-EUFlag/background.png',[[50.5032,13.2862],[49.1482,16.0714]]);
    Hungary[0] = L.imageOverlay('img-EUFlag/background.png',[[47.6656,17.5537],[46.3273,20.9670]]);
    Slovakia[0] = L.imageOverlay('img-EUFlag/background.png',[[49.0008,17.9197],[48.1833,20.23282]]);
    Poland[0] = L.imageOverlay('img-EUFlag/background.png',[[53.2500,16.71449],[51.2416,21.7946]]);
    Slovenia[0] = L.imageOverlay('img-EUFlag/background.png',[[46.3581,13.9128],[45.7320,15.2791]]);
    Sweden[0] = L.imageOverlay('img-EUFlag/background.png',[[60.6619,13.0230],[58.7009,18.8128]]);

   // Deutschlandpoly_array = [Land_overlay_array_coordinate[0][0],[Land_overlay_array_coordinate[0][0][0],Land_overlay_array_coordinate[0][1][0]],Land_overlay_array_coordinate[0][1],[Land_overlay_array_coordinate[0][0][0],Land_overlay_array_coordinate[0][1][1]]];

    // console.log(Land_overlay_array_coordinate[0][0],[Land_overlay_array_coordinate[0][1][0],Land_overlay_array_coordinate[0][0][1]],Land_overlay_array_coordinate[0][1],[Land_overlay_array_coordinate[0][0][0],Land_overlay_array_coordinate[0][1][1]]);
    // Deutschlandpoly_array=[Land_overlay_array_coordinate[0][0],[Land_overlay_array_coordinate[0][1][0],Land_overlay_array_coordinate[0][0][1]],Land_overlay_array_coordinate[0][1],[Land_overlay_array_coordinate[0][0][0],Land_overlay_array_coordinate[0][1][1]]];
    // Deutschland_polygon = L.polygon((Deutschlandpoly_array), {draggable: true, opacity: 0, fillOpacity: 0});
    // Deutschland_imageBound = L.latLngBounds([Deutschlandpoly_array[0], Deutschlandpoly_array[2]]);
    //
    // Deutschland_overlay = L.imageOverlay("img-EUFlag/Germany.png",Deutschland_imageBound,{opacity:1, interactive:true});
    //
    // Deutschland_polygon.on('drag',function (e) {Deutschland_overlay.setBounds(Deutschland_polygon.getBounds());});
    // Deutschland_polygon.on('dragstart',function (e) {Deutschland_overlay.setBounds(Deutschland_polygon.getBounds());});
    // Deutschland_polygon.on('dragend',function (e) {
    //     Deutschland_overlay.setBounds(Deutschland_polygon.getBounds());
    //     console.log(Deutschland_polygon.getBounds().getNorthWest().lat);
    //     console.log(Deutschland_polygon.getBounds().getSouthEast().lng);
    //     console.log(Deutschland_polygon.getBounds().getSouthEast().lat);
    //     console.log(Deutschland_polygon.getBounds().getNorthWest().lng);
    // });



    Land_array=[Deutschland,Frankreich,Spanien,Croatia,Belgium,Bulgaria,Cyprus,Estonia,Finland,Greece,Latvia,Lithuania,Malta,Portugal,Italy,Romania,Denmark,Ireland,UK,Netherland,Luxenburg,Austria,Czechia,Hungary,Slovakia,Poland,Slovenia,Sweden];
    //Land_array= [Deutschland,Frankreich,Spanien];



    var min=0;
    var max=(Land_array.length);
    //get a random integer between max and min
    var index = Math.floor(Math.random()* (max - min)) + min;


    for(let i=0;output.length<10;i++){
        //get a random integer between max and min

        index = Math.floor(Math.random()* (max - min)) + min;
        if(!test_in_array(index,output))
        {
            continue;
        }
        output.push(index);
    };

    function test_in_array(index,arr)
    {
        for(let j=0;j<output.length;j++)
        {
            if(arr[j]==index)
            {
                return false;
            }
        }
        return true;
    };

    console.log(output.length);

    for(let k = 0; k<output.length;k++)
    {
         temp = Land_array[output[k]];
         temp[0].addTo(mymap);
        temp[1] = [Land_overlay_array_coordinate[k][0],[Land_overlay_array_coordinate[k][1][0],Land_overlay_array_coordinate[k][0][1]],Land_overlay_array_coordinate[k][1],[Land_overlay_array_coordinate[k][0][0],Land_overlay_array_coordinate[k][1][1]]];
        temp[4] =  L.polygon(temp[1], {draggable: true, opacity: 0.5, fillOpacity: 0}).addTo(mymap);
        temp[2] = L.latLngBounds([temp[1][0], temp[1][2]]);
        temp[3] = L.imageOverlay(Land_overlay_imagepath[output[k]],temp[2],{opacity:1, interactive:true}).addTo(mymap);
        temp[4].on('drag',function (e) {temp[3].setBounds(temp[4].getBounds());});
        temp[4].on('dragstart',function (e) {temp[3].setBounds(temp[4].getBounds());});
        temp[4].on('dragend',function (e) {
            temp[3].setBounds(temp[4].getBounds());
        });
    }

    mymap.on('zoomend', function(){
        $("#zoom-level").html(mymap.getZoom());
    });

    mymap.on('moveend', function(){
        $("#map-center").html(LatLngToArrayString(mymap.getCenter()));
    });

    mymap.on('mousemove', function(e){
        $("#mouse-location").html(LatLngToArrayString(e.latlng));
    });

    $("#export_exerciseChain").click(function () {
        var txt="<?xml version=\"1.0\" encoding=\"UTF-8\"?>"+'\n';
        txt= txt + "<exercisechain>"+'\n';
        txt= txt + "  <step id=\"1\" displayName=\"Stage 1\" file=\"stage1.xml\" >" +'\n';
        txt= txt + "    <next default=\"repeat\" message=\"Versuche es noch mal.\" >"+ '\n';
        txt= txt + "      <path target=\"end\" result=\"100\" />" + '\n' + "    </next>"+'\n';
        txt= txt + "  </step>"+'\n';
        txt= txt + "</exercisechain>";
        var blob = new Blob([txt], {type: "text/plain;charset=utf-8"});
        saveAs(blob, "exerciseChain.xml");
    });

    $("#export_Stage").click(function () {
        var txt="<?xml version=\"1.0\" encoding=\"UTF-8\"?>"+'\n';
        txt= txt + "<exercise type=\"fillIn\">"+'\n';
        txt= txt + "    <task>"+'\n';
        txt= txt + createXMLStringAufgabe4fill_in_blanks(output,markerarray,Deutschland);
        txt= txt + "    </task>"+'\n';
        txt= txt + "   <skipmessage>" +'\n';
        txt= txt + "   </skipmessage>"+'\n';
        txt= txt + "</exercise>";
        var blob = new Blob([txt], {type: "text/plain;charset=utf-8"});
        saveAs(blob, "stage1.xml");
    });

    function LatLngToArrayString(ll) {
        return "["+ll.lat.toFixed(5)+", "+ll.lng.toFixed(5)+"]";

    }
</script>

</body>
</html>